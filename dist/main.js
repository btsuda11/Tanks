!function(){"use strict";!function(){class s{constructor(s,t,e){this.height=s,this.width=t,this.pos=e}draw(s){let t=new Image;t.src="images/wooden_wall.png",s.drawImage(t,this.pos[0],this.pos[1],this.width,this.height)}}Function.prototype.myThrottle=function(s,t){let e=0;return()=>{e===s.maxBullets?(e++,setTimeout((()=>{e=0}),t)):e<s.maxBullets&&(this.call(s),e++)}};class t{constructor(s,t,e){var i,h;h=s=>new Promise((t=>setTimeout(t,s))),(i="timeout")in this?Object.defineProperty(this,i,{value:h,enumerable:!0,configurable:!0,writable:!0}):this[i]=h,this.pos=s,this.tank=t,this.ctx=e,this.radius=60,this.timeoutID=setTimeout((()=>{this.explode()}),1e4)}draw(s){s.fillStyle="yellow",s.beginPath(),s.arc(this.pos[0],this.pos[1],8,0,2*Math.PI),s.fill(),s.strokeStyle="black",s.stroke()}explode(){this.exploded=!0;for(let s=0;s<this.tank.game.tanks.length;s++)if(this.inRadius(this.tank.game.tanks[s]))return this.tank.game.remove(this),void this.tank.game.remove(this.tank.game.tanks[s]);this.tank.game.remove(this)}inRadius(s){let t,h;return s instanceof e?(t=Math.abs(this.pos[0]-s.bodyPos[0]-s.width/2),h=Math.abs(this.pos[1]-s.bodyPos[1]-s.height/2)):s instanceof i&&(t=Math.abs(this.pos[0]-s.pos[0]-s.width/2),h=Math.abs(this.pos[1]-s.pos[1]-s.height/2)),!(t>s.width/2+this.radius||h>s.height/2+this.radius||!(t<=s.width/2||h<=s.height/2||(t-s.width/2)**2+(h-s.height/2)**2<=this.radius**2))}async drawExplosion(){for(let s=0;s<this.explosion.length;s++)await this.timeout(1e3),this.ctx.drawImage(this.explosion[s],0,0,60,60,this.pos[0],this.pos[1],60,60)}}class e{constructor(s){this.barrelPos=s.pos,this.bodyPos=s.pos,this.angle=0,this.vel=[0,0,0,0],this.body=new Image,this.barrel=new Image,this.state="alive",this.game=s.game}draw(s){}move(){}checkBounds(){this.bodyPos[0]<0&&(this.vel[0]=0),this.bodyPos[1]<0&&(this.vel[2]=0),this.bodyPos[0]+42.5>n.DIM_X&&(this.vel[1]=0),this.bodyPos[1]+44>n.DIM_Y&&(this.vel[3]=0)}hittingObject(t){return t instanceof s?this.bodyPos[0]+2<t.pos[0]+t.width&&this.bodyPos[0]+this.width-2>t.pos[0]&&this.bodyPos[1]+this.height-2>t.pos[1]&&this.bodyPos[1]+2<t.pos[1]+t.height||this.bodyPos[1]+2<t.pos[1]+t.height&&this.bodyPos[1]+this.height-2>t.pos[1]&&this.bodyPos[0]+this.width-2>t.pos[0]&&this.bodyPos[0]+2<t.pos[0]+t.width:this.bodyPos[0]+2<t.bodyPos[0]+t.width&&this.bodyPos[0]+this.width-2>t.bodyPos[0]&&this.bodyPos[1]+this.height-2>t.bodyPos[1]&&this.bodyPos[1]+2<t.bodyPos[1]+t.height||this.bodyPos[1]+2<t.bodyPos[1]+t.height&&this.bodyPos[1]+this.height-2>t.bodyPos[1]&&this.bodyPos[0]+this.width-2>t.bodyPos[0]&&this.bodyPos[0]+2<t.bodyPos[0]+t.width}shoot(){let s,t=50*Math.cos(this.angle+Math.PI/2),e=50*Math.sin(this.angle+Math.PI/2);s=new i({pos:[this.barrelPos[0]+20+t,this.barrelPos[1]+20+e],speed:3,angle:this.angle+Math.PI/2,tank:this}),this.game.add(s)}placeMine(){if(this.game.mines.length<this.maxMines){const s=new t([this.bodyPos[0]+20,this.bodyPos[1]+20],this,this.game.ctx);this.game.add(s)}}}class i{constructor(s){this.pos=s.pos,this.speed=s.speed,this.angle=s.angle,this.vel=[this.speed*Math.cos(this.angle),this.speed*Math.sin(this.angle)],this.tank=s.tank,this.height=12,this.width=8,this.numRicochets=0}draw(s){let t=new Image;t.src="images/bullets/bulletDark2.png",s.save(),s.translate(this.pos[0],this.pos[1]),s.rotate(this.angle-3*Math.PI/2),s.drawImage(t,0,0),s.restore()}move(){this.checkRicochet(),this.pos[0]+=this.vel[0],this.pos[1]+=this.vel[1]}checkRicochet(){this.numRicochets>=2&&this.tank.game.remove(this),this.tank.game.walls.forEach((s=>{this.pos[0]<=s.pos[0]+s.width+5&&this.pos[0]>=s.pos[0]+s.width&&this.pos[1]+this.height>=s.pos[1]&&this.pos[1]<=s.pos[1]+s.height||this.pos[0]+this.width>=s.pos[0]-5&&this.pos[0]+this.width<=s.pos[0]&&this.pos[1]+this.height>=s.pos[1]&&this.pos[1]<=s.pos[1]+s.height?(this.vel[0]=-this.vel[0],this.angle=-this.angle,this.numRicochets++):(this.pos[0]+this.width>=s.pos[0]&&this.pos[0]<=s.pos[0]+s.width&&this.pos[1]+this.height>=s.pos[1]-5&&this.pos[1]+this.height<=s.pos[1]||this.pos[0]+this.width>=s.pos[0]&&this.pos[0]<=s.pos[0]+s.width&&this.pos[1]<=s.pos[1]+s.height+5&&this.pos[1]>=s.pos[1]+s.height)&&(this.vel[1]=-this.vel[1],this.angle=-this.angle,this.numRicochets++)})),this.pos[0]<0&&(this.vel[0]=-this.vel[0],this.angle=-this.angle,this.numRicochets++),this.pos[1]<0&&(this.vel[1]=-this.vel[1],this.angle=-this.angle,this.numRicochets++),this.pos[0]+this.width>n.DIM_X&&(this.vel[0]=-this.vel[0],this.angle=-this.angle,this.numRicochets++),this.pos[1]+this.height>n.DIM_Y&&(this.vel[1]=-this.vel[1],this.angle=-this.angle,this.numRicochets++)}hasHit(s){if(s instanceof e)return this.pos[0]<=s.bodyPos[0]+s.width+10&&this.pos[0]>=s.bodyPos[0]+s.width&&this.pos[1]+this.height>=s.bodyPos[1]&&this.pos[1]<=s.bodyPos[1]+s.height||this.pos[0]+this.width>=s.bodyPos[0]-10&&this.pos[0]+this.width<=s.bodyPos[0]&&this.pos[1]+this.height>=s.bodyPos[1]&&this.pos[1]<=s.bodyPos[1]+s.height||this.pos[0]+this.width>=s.bodyPos[0]&&this.pos[0]<=s.bodyPos[0]+s.width&&this.pos[1]+this.height>=s.bodyPos[1]-10&&this.pos[1]+this.height<=s.bodyPos[1]||this.pos[0]+this.width>=s.bodyPos[0]&&this.pos[0]<=s.bodyPos[0]+s.width&&this.pos[1]<=s.bodyPos[1]+s.height+10&&this.pos[1]>=s.bodyPos[1]+s.height;if(s instanceof i)return this.pos[0]<=s.pos[0]+s.width&&this.pos[0]+this.width>=s.pos[0]&&this.pos[1]+this.height>=s.pos[1]&&this.pos[1]<=s.pos[1]+s.height||this.pos[1]<=s.pos[1]+s.height&&this.pos[1]+this.height>=s.pos[1]&&this.pos[0]+this.width>=s.pos[0]&&this.pos[0]<=s.pos[0]+s.width;if(s instanceof t){let t=Math.abs(s.pos[0]-this.pos[0]-this.width/2),e=Math.abs(s.pos[1]-this.pos[1]-this.height/2);return!(t>this.width/2+8||e>this.height/2+8||!(t<=this.width/2||e<=this.height/2||(t-this.width/2)**2+(e-this.height/2)**2<=64))}}hits(s){if(s instanceof t)return clearTimeout(s.timeoutID),s.explode(),void this.tank.game.remove(this);s instanceof e&&(s.state="dead"),this.tank.game.remove(this),this.tank.game.remove(s)}}class h extends e{constructor(s){super(s),this.body.src="images/tanks/tankBody_blue_outline.png",this.barrel.src="images/tanks/tankBlue_barrel2_outline.png",this.height=this.body.height,this.width=this.body.width,this.barrelHeight=this.barrel.height,this.barrelWidth=this.barrel.width,this.maxBullets=5,this.maxMines=1,this.allowedRicochets=0}draw(s){s.drawImage(this.body,this.bodyPos[0],this.bodyPos[1]),s.save(),s.translate(this.barrelPos[0]+20,this.barrelPos[1]+20),s.rotate(this.angle),s.drawImage(this.barrel,-5,-5),s.restore()}move(){this.checkBounds(),this.barrelPos[0]+=this.vel[0],this.barrelPos[0]+=this.vel[1],this.barrelPos[1]+=this.vel[2],this.barrelPos[1]+=this.vel[3],this.bodyPos[0]+=this.vel[0],this.bodyPos[0]+=this.vel[1],this.bodyPos[1]+=this.vel[2],this.bodyPos[1]+=this.vel[3],this.angle=Math.atan2(this.game.cursorPos[1]-this.barrelPos[1],this.game.cursorPos[0]-this.barrelPos[0])-Math.PI/1.95,this.game.walls.concat(this.game.tanks).forEach((t=>{t!==this&&(t instanceof s?this.hittingObject(t)&&this.vel[0]<0?(this.barrelPos[0]-=2*this.vel[0],this.bodyPos[0]-=2*this.vel[0],this.vel[0]=0):this.hittingObject(t)&&this.vel[1]>0?(this.barrelPos[0]-=2*this.vel[1],this.bodyPos[0]-=2*this.vel[1],this.vel[1]=0):this.hittingObject(t)&&this.vel[2]<0?(this.barrelPos[1]-=2*this.vel[2],this.bodyPos[1]-=2*this.vel[2],this.vel[2]=0):this.hittingObject(t)&&this.vel[3]>0&&(this.barrelPos[1]-=2*this.vel[3],this.bodyPos[1]-=2*this.vel[3],this.vel[3]=0):this.hittingObject(t)&&this.vel[0]<0?(this.barrelPos[0]-=2*this.vel[0],this.bodyPos[0]-=2*this.vel[0],this.vel[0]=-.75,t.vel[0]=-.75):this.hittingObject(t)&&this.vel[1]>0?(this.barrelPos[0]-=2*this.vel[1],this.bodyPos[0]-=2*this.vel[1],this.vel[1]=.75,t.vel[1]=.75):this.hittingObject(t)&&this.vel[2]<0?(this.barrelPos[1]-=2*this.vel[2],this.bodyPos[1]-=2*this.vel[2],this.vel[2]=-.75,t.vel[2]=-.75):this.hittingObject(t)&&this.vel[3]>0&&(this.barrelPos[1]-=2*this.vel[3],this.bodyPos[1]-=2*this.vel[3],this.vel[3]=.75,t.vel[3]=.75))}))}}class o extends e{constructor(s){super(s),this.type=s.type,this.allowedRicochets=1,"red"===this.type&&(this.body.src="images/tanks/tankBody_red_outline.png",this.barrel.src="images/tanks/tankRed_barrel2_outline.png",this.maxBullets=1,this.maxMines=0,this.height=this.body.height,this.width=this.body.width),"green"===this.type&&(this.body.src="images/tanks/tankBody_green_outline.png",this.barrel.src="images/tanks/tankGreen_barrel2_outline.png",this.maxBullets=2,this.maxMines=0,this.height=this.body.height,this.width=this.body.width),setInterval((()=>{"alive"===this.state&&this.shoot()}),1500)}draw(s){s.drawImage(this.body,this.bodyPos[0],this.bodyPos[1]),s.save(),s.translate(this.barrelPos[0]+18,this.barrelPos[1]+22),s.rotate(this.angle),s.drawImage(this.barrel,-5,-5),s.restore()}move(){Math.abs(this.distToPlayer()[1])<Math.abs(this.distToPlayer()[0])&&this.distToPlayer()[2]>200&&Math.abs(this.distToPlayer()[1])>5?this.distToPlayer()[1]>0?this.vel[3]=.75:this.distToPlayer()[1]<0&&(this.vel[2]=-.75):Math.abs(this.distToPlayer()[0])<Math.abs(this.distToPlayer()[1])&&this.distToPlayer()[2]>200&&Math.abs(this.distToPlayer()[0])>5&&(this.distToPlayer()[0]>0?this.vel[1]=.75:this.distToPlayer()[0]<0&&(this.vel[0]=-.75)),this.checkBounds(),this.barrelPos[0]+=this.vel[0],this.barrelPos[0]+=this.vel[1],this.barrelPos[1]+=this.vel[2],this.barrelPos[1]+=this.vel[3],this.bodyPos[0]+=this.vel[0],this.bodyPos[0]+=this.vel[1],this.bodyPos[1]+=this.vel[2],this.bodyPos[1]+=this.vel[3];let s=[this.game.playerTank.bodyPos[0]+this.game.playerTank.width/2,this.game.playerTank.bodyPos[1]+this.game.playerTank.height/2];this.angle=Math.atan2(s[1]-this.barrelPos[1],s[0]-this.barrelPos[0])-Math.PI/1.95,this.game.walls.forEach((s=>{this.hittingObject(s)&&this.vel[0]<0?(this.barrelPos[0]-=2*this.vel[0],this.bodyPos[0]-=2*this.vel[0],this.vel[0]=0):this.hittingObject(s)&&this.vel[1]>0?(this.barrelPos[0]-=2*this.vel[1],this.bodyPos[0]-=2*this.vel[1],this.vel[1]=0):this.hittingObject(s)&&this.vel[2]<0?(this.barrelPos[1]-=2*this.vel[2],this.bodyPos[1]-=2*this.vel[2],this.vel[2]=0):this.hittingObject(s)&&this.vel[3]>0&&(this.barrelPos[1]-=2*this.vel[3],this.bodyPos[1]-=2*this.vel[3],this.vel[3]=0)})),this.vel=[0,0,0,0]}shoot(){let s,t=50*Math.cos(this.angle+Math.PI/2),e=50*Math.sin(this.angle+Math.PI/2);"red"===this.type?s=new i({pos:[this.barrelPos[0]+20+t,this.barrelPos[1]+20+e],speed:3,angle:this.angle+Math.PI/2,tank:this}):"green"===this.type&&(s=new i({pos:[this.barrelPos[0]+20+t,this.barrelPos[1]+20+e],speed:6,angle:this.angle+Math.PI/2,tank:this})),this.game.add(s)}distToPlayer(){let s=this.game.playerTank.bodyPos[0]-this.bodyPos[0],t=this.game.playerTank.bodyPos[1]-this.bodyPos[1];return[s,t,Math.sqrt(s**2+t**2)]}}class a{constructor(s){this.ctx=s,this.game=new n(this.ctx)}start(){this.game.startLevel()}}class n{constructor(s){this.ctx=s,this.level=1,this.playerTank=new h({pos:[150,650],game:this}),this.bullets=[],this.mines=[],this.cursorPos=[],this.getDOMElements(),this.bindClickListeners(),this.gameOff=!1,this.bindGameKeys=this.bindGameKeys.bind(this),this.update=this.update.bind(this)}showInstructions(){this.startScreen.style.display="none",this.instructions.style.display="flex"}resetStats(){this.tanks.forEach((s=>{s.vel=[0,0,0,0]})),this.playerTank.bodyPos=[150,650],this.playerTank.barrelPos=[150,650],this.bullets=[]}populateLevel(){1===this.level?(this.enemyTanks=[new o({pos:[1250,125],game:this,type:"red"})],this.tanks=[this.playerTank].concat(this.enemyTanks),this.walls=[new s(75,750,[250,200]),new s(75,750,[400,550])]):2===this.level&&(this.enemyTanks=[new o({pos:[700,125],game:this,type:"green"}),new o({pos:[1250,500],game:this,type:"green"})],this.tanks=[this.playerTank].concat(this.enemyTanks),this.walls=[new s(75,150,[125,500]),new s(75,75,[200,575]),new s(75,150,[1150,200]),new s(75,75,[1150,125])])}startLevel(){this.populateLevel(),this.missionHeader.innerHTML=`Mission ${this.level}`,this.enemyTanksHeader.innerHTML=`Enemy Tanks: ${this.enemyTanks.length}`,this.gameMission.children[0].innerHTML=`Mission ${this.level}`,this.music[0].play(),this.canvas.style.display="block",this.startScreen.style.display="none",this.missionScreen.style.display="block",setTimeout((()=>{this.missionScreen.style.display="none",this.draw(this.ctx),this.gameMission.style.display="block",setTimeout((()=>{this.start.style.display="block",setTimeout((()=>this.start.style.display="none"),2e3),this.bindGameKeys(),this.update(this.ctx)}),1e3)}),4e3)}returnHome(){this.music[2].pause(),this.music[2].currentTime=0,this.endScreen[0].style.display="none",this.canvas.style.display="none",this.startScreen.style.display="flex"}endLevel(){this.music[0].pause(),this.music[0].currentTime=0,this.music[1].play(),this.gameMission.style.display="none";let s=document.getElementsByClassName("mission-cleared")[0];s.style.display="block",this.level++,setTimeout((()=>{s.style.display="none",this.resetStats(),this.startLevel()}),5e3)}gameOver(){this.music[0].pause(),this.music[2].play(),this.music[0].currentTime=0,this.gameOff=!0,this.gameMission.style.display="none",this.missionFailed[0].style.display="block",setTimeout((()=>{this.missionFailed[0].style.display="none",this.endScreen[0].style.display="flex"}),5e3)}newGame(){new n(this.ctx).startLevel()}playAgain(){this.music[0].currentTime=0,this.music[2].pause(),this.music[2].currentTime=0,this.endScreen[0].style.display="none",this.canvas.style.display="none",this.newGame()}add(s){s instanceof o?this.enemyTanks.push(s):s instanceof i?this.bullets.push(s):s instanceof t&&this.mines.push(s)}draw(s){s.clearRect(0,0,n.DIM_X,n.DIM_Y),this.allObjects().forEach((t=>{t.draw(s)}))}moveObjects(){[].concat(this.playerTank,this.enemyTanks,this.bullets).forEach((s=>{s.move()}))}update(s){!0!==this.gameOff&&(this.step(),this.draw(s)),this.frameID=requestAnimationFrame((()=>this.update(s)))}checkCollisions(){for(let s=0;s<this.bullets.length;s++){for(let t=0;t<this.tanks.length;t++)if(this.bullets[s].hasHit(this.tanks[t])&&!(this.bullets[s].tank instanceof o&&this.tanks[t]instanceof o))return void this.bullets[s].hits(this.tanks[t]);for(let t=0;t<this.bullets.length;t++)if(this.bullets[s]!==this.bullets[t]&&this.bullets[s].hasHit(this.bullets[t]))return void this.bullets[s].hits(this.bullets[t]);for(let t=0;t<this.mines.length;t++)if(this.bullets[s].hasHit(this.mines[t]))return void this.bullets[s].hits(this.mines[t])}}step(){this.moveObjects(),this.checkCollisions()}remove(s){s instanceof i?this.bullets.splice(this.bullets.indexOf(s),1):s instanceof e?(s instanceof h?this.gameOver():this.enemyTanks.splice(this.enemyTanks.indexOf(s),1),this.tanks.splice(this.tanks.indexOf(s),1),0===this.enemyTanks.length&&this.endLevel()):s instanceof t&&this.mines.splice(this.mines.indexOf(s),1)}allObjects(){return[].concat(this.tanks,this.bullets,this.walls,this.mines)}static get DIM_X(){return window.innerWidth}static get DIM_Y(){return window.innerHeight}mouseOnPage(s){this.cursorPos=[s.clientX,s.clientY]}bindClickListeners(){this.startButton.addEventListener("click",(()=>this.newGame())),this.returnHomeButton.addEventListener("click",(()=>this.returnHome())),this.playAgainButton.addEventListener("click",(()=>this.playAgain())),this.howToButton.addEventListener("click",(()=>this.showInstructions())),this.instructions.addEventListener("click",(()=>{this.instructions.style.display="none",this.startScreen.style.display="flex"}))}bindGameKeys(){document.addEventListener("mousemove",(s=>this.mouseOnPage(s))),document.addEventListener("keydown",(s=>{"KeyA"===s.code&&(this.playerTank.vel[0]=-1),"KeyD"===s.code&&(this.playerTank.vel[1]=1),"KeyW"===s.code&&(this.playerTank.vel[2]=-1),"KeyS"===s.code&&(this.playerTank.vel[3]=1)})),document.addEventListener("keyup",(s=>{"KeyA"===s.code&&(this.playerTank.vel[0]=0),"KeyD"===s.code&&(this.playerTank.vel[1]=0),"KeyW"===s.code&&(this.playerTank.vel[2]=0),"KeyS"===s.code&&(this.playerTank.vel[3]=0)})),document.addEventListener("click",this.playerTank.shoot.myThrottle(this.playerTank,2e3)),document.addEventListener("keydown",(s=>{"Space"===s.code&&this.playerTank.placeMine()}))}getDOMElements(){this.canvas=document.querySelector("#game-canvas"),this.missionScreen=document.querySelector(".mission-screen"),this.missionHeader=document.querySelector(".mission"),this.enemyTanksHeader=document.querySelector(".enemy-tanks"),this.startScreen=document.querySelector("#start-screen"),this.startButton=document.querySelector("#start-button"),this.start=document.querySelector("#start"),this.howToButton=document.querySelector("#how-to-button"),this.missionFailed=document.getElementsByClassName("mission-failed"),this.endScreen=document.getElementsByClassName("end-screen"),this.playAgainButton=this.endScreen[0].children[0],this.returnHomeButton=this.endScreen[0].children[1],this.instructions=document.querySelector("#how-to"),this.gameMission=document.querySelector("#game-mission"),this.music=document.getElementsByClassName("music")}removeGameKeys(){document.removeEventListener("keydown",(s=>{"KeyA"===s.code&&(this.playerTank.vel[0]=-1),"KeyD"===s.code&&(this.playerTank.vel[1]=1),"KeyW"===s.code&&(this.playerTank.vel[2]=-1),"KeyS"===s.code&&(this.playerTank.vel[3]=1)})),document.removeEventListener("keyup",(s=>{"KeyA"===s.code&&(this.playerTank.vel[0]=0),"KeyD"===s.code&&(this.playerTank.vel[1]=0),"KeyW"===s.code&&(this.playerTank.vel[2]=0),"KeyS"===s.code&&(this.playerTank.vel[3]=0)})),document.removeEventListener("click",this.playerTank.shoot.myThrottle(this.playerTank,2e3)),document.removeEventListener("keydown",(s=>{"Space"===s.code&&this.playerTank.placeMine()}))}}document.addEventListener("DOMContentLoaded",(()=>{const s=document.getElementById("game-canvas");s.height=n.DIM_Y,s.width=n.DIM_X;const t=s.getContext("2d");new a(t)}))}()}();
//# sourceMappingURL=main.js.map